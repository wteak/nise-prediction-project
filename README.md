#  대용량 시계열 데이터 기반 태양광 일사량 예측 모델

## 1. 프로젝트 개요
본 프로젝트는 약 1,900만 행에 달하는 방대한 환경 센서 데이터를 분석하여 태양광 발전의 핵심 변수인 일사량(nins)을 예측하는 AI 모델링 프로젝트입니다.

전체 데이터의 **90% 이상이 결측치**로 이루어진 데이터 환경에서, 단순한 모델 튜닝을 넘어 데이터 중심의 전처리 전략과 물리적 도메인 지식을 결합하여 결측 정보를 복원하고 예측 정확도를 극대화하는 데 초점을 맞췄습니다.

* **활동 기간:** 2025.10.25 ~ 2025.11.14
* **참가 형태:** 팀 프로젝트 (우택 외 1명)
* **주요 목표:** 대용량 시계열 데이터 파이프라인 구축 및 결측치 복원 최적화


###  데이터 상세 정보 

#### 1. 기본 정보 및 타겟
| 변수명 | 설명 | 단위 |
| :--- | :--- | :---: |
| `time` | 데이터 측정 시간 | - |
| `pv_id` | 발전소 고유 ID | - |
| `type` | 데이터 구분 (train/test) | - |
| `coord1`, `coord2` | 발전소 위치 좌표 (보안상 익명화) | - |
| **`nins`** | **[Target] 태양광 일사량** | **W/m²** |
| `energy` | 발전량 (Train 데이터에만 존재) | kWh |

#### 2. 기상 관측소 A 데이터
| 변수명 | 설명 | 단위 |
| :--- | :--- | :---: |
| `temp_a` | 대기 중의 실제 온도 | °C |
| `humidity` | 습도 (상대습도) | % |
| `wind_spd_a` | 풍속 | km/h |
| `wind_dir_a` | 풍향 | ° |
| `cloud_a` | 구름량 (운량) | % |
| `rain` | 강우량 | mm |
| `snow` | 강설량 | mm |
| `ground_press` | 지면 기압 | hPa |
| `temp_max` / `min` | 해당 시간대의 최고/최저 기온 | °C |

#### 3. 기상 관측소 B 및 파생 데이터 
| 변수명 | 설명 | 단위 |
| :--- | :--- | :---: |
| `temp_b` | 기상관측소 B의 기온 | °C |
| `rel_hum` | 상대습도 | % |
| `wind_spd_b` | 풍속 | km/h |
| `wind_dir_b` | 풍향 | ° |
| `cloud_b` | 구름량 | % |
| `pressure` | 대기압 | hPa |
| `precip_1h` | 1시간 강수량 | mm |
| `appr_temp` | 체감 온도 | °C |
| `real_feel_temp` | 날씨 조건(바람, 습도) 반영 체감 온도 | °C |
| `real_feel_temp_shade` | 그늘 체감 온도 | °C |
| `wind_chill_temp` | 풍속 냉각 온도 | °C |
| `dew_point` | 이슬점 | °C |
| `uv_idx` | 자외선 지수 | - |
| `vis` | 가시거리 | km |
| `ceiling` | 구름층 높이 (천장고) | m |
| `wind_gust_spd` | 돌풍 속도 | km/h |

---

## 2. 핵심 기술 구성
* **언어:** Python 3.13.7
* **데이터 처리:** Pandas, Numpy (Feather 포맷 활용)
* **모델링:** LightGBM Regressor
* **군집화:** Scikit-learn (KMeans, StandardScaler)
* **환경:** VS Code, Jupyter Notebook




## 3. 프로젝트 구조

```bash
nins-prediction-project/
│
├── README.md                 # 프로젝트 설명서 (현재 파일)
├── main                      # 최종코드
├── requirements.txt          # 필요 라이브러리 목록
│── data/                     # 용량 문제 및 보안 문제로 저장소에 포함되지 않았습니다. 
│   ├── train.csv             # 학습 데이터
│   ├── test.csv              # 추론 데이터
│   └── sample_submission.csv # 제출 양식 파일
├── modules/                  # 최종 코드에 직접적으로 활용된 로직들
│   ├── 01.ipynb  # CSV 대용량 처리 및 Feather 변환
│   ├── 02.ipynb  # 타겟 분리 및 데이터 통합
│   └── 03.ipynb  # 결측치 보간 및 군집화 로직
│
└── archive/                  # [연구 기록] 시행착오 로직들
    ├── 01.ipynb   # 복합 보간법 시도 및 메모리 문제로 인한 chunk병합
    ├── 02.ipynb   # 초기 파생변수 생성 실험
    ├── 03.ipynb   # 맵핑 방식 접근 시도 및 군집
    └── 04.ipynb   # 모델 학습 실험
```
---    
## 4. 핵심 수행 내용

### 1) 데이터 전처리 최적화
* 입출력 속도가 빠른 Feather 포맷을 도입하여 데이터 로딩 속도를 획기적으로 개선했습니다.
* 선형이나 스플라인 보간은 긴 결측 구간에서 왜곡된 패턴을 생성함을 확인했습니다. 이에 물리적 추세를 보수적으로 유지하면서 노이즈를 최소화하는 전방 및 후방 채우기 방식을 최종 채택했습니다.

### 2) 통합 파이프라인 구축
* 학습(train) 데이터와 추론 test) 데이터를 개별 처리할 경우, 군집화 기준이 달라지거나 시계열 연결성이 끊겨 예측 성능이 하락하는 분포 불일치 문제가 발생했습니다.
* 두 데이터를 하나로 합쳐 처리하는 통합 파이프라인을 구축하고, 처리 후 다시 분리할 때 원본 순서를 100% 복구하는 안전장치를 마련하여 데이터 정합성을 확보했습니다.

### 3) 파생 변수 최적화
* 초기에는 물리 공식과 다양한 시차를 조합하여 110개 이상의 파생 변수를 생성했으나, 변수가 많아질수록 과적합 위험이 커지고 학습 속도가 저하됨을 확인했습니다. 
* 이에 변수 중요도 분석을 통해 예측에 필수적인 시차 변수와 물리 변수만을 남기는 정보 밀도 최적화 전략을 수행하여, 최종적으로 94개의 핵심 변수를 선별했습니다.

### 4) 계층적 이중 군집화
단순 군집화의 한계를 극복하기 위해 데이터의 특성에 따라 해상도를 달리하는 이원화 전략을 수립했습니다.
* **위치 군집 (20개):** 발전소의 위도와 경도 좌표를 기반으로 미세 지형과 음영 효과를 반영하기 위해 군집을 세분화했습니다.
* **기후 군집 (10개):** 기온, 습도, 풍속 등 기상 변수를 기반으로, 지리적 위치와 무관하게 유사한 거시적 기상 패턴을 공유하는 발전소들을 묶어 일반화 성능을 강화했습니다.

### 5) 물리 정보 기반 동적 마스킹
데이터의 물리적 정합성을 확보하기 위해 천문학적 도메인 지식을 모델링 파이프라인에 결합했습니다.
* **태양 고도 변수 생성:** 단순한 시간 변수 대신, 태양의 남중 고도와 계절별 낮의 길이 변화를 반영한 코사인 변수를 생성하여 모델이 태양 에너지의 물리적 주기를 이해하도록 설계했습니다.
* **야간 마스킹 적용:** 생성된 코사인 값을 기준으로 물리적으로 해가 뜰 수 없는 야간 시간대를 식별하고, 해당 구간의 예측값을 강제로 0으로 보정하여 노이즈를 원천 차단했습니다.

## 5. 결과 (Results)

`data` 목록의 데이터들과 함께 `main_pipeline.ipynb` 실행 시 다음과 같은 최종 파일 `submission_Final_Hybrid`가 생성됩니다.

| time | pv_id | nins (Predicted) |
| :--- | :--- | :--- |
| 2024-08-01 00:00:00 | PV_ID_1 | 0.0 |
| 2024-08-01 01:00:00 | PV_ID_1 | 0.0 |
| ... | ... | ... |
| 2024-xx-xx 12:00:00 | PV_ID_X | 854.32 |

* **최종 성과:** 초기 단순 모델 대비 성능을 향상시켰으며, 최종적으로 **MAE 52점대**를 달성했습니다.
